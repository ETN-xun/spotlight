# RandomMapGenerator 使用文档

## 概述
RandomMapGenerator 是一个用于生成符合塔防游戏需求的随机地图生成器。它能够生成包含不同地形类型和可破坏对象的地图，同时确保路径连通性和区域限制。

## 主要功能

### 1. 地形生成
- **普通地块 (Plain)**: 基础可行走地形
- **腐蚀地块 (Corrosion)**: 特殊效果地形，可行走
- **虫洞地块 (BugTile)**: 不可行走地形，阻挡移动

### 2. 可破坏对象生成
- **缓存区 (Register)**: 游戏目标对象，只能放置在中间区域
- **防火墙 (FireWall)**: 可破坏的阻挡物，影响路径规划

### 3. 区域限制
- **玩家部署区**: 地图底部区域，用于玩家单位部署
- **敌人生成区**: 地图顶部区域，敌人生成位置
- **中间区域**: 主要游戏区域，包含大部分游戏对象

### 4. 路径验证
- 确保从敌人生成区到玩家部署区至少有一条可行走路径
- 自动修复路径连通性问题
- 防止无解地图的生成

## 配置参数

### 地图设置
- `mapWidth`: 地图宽度 (默认: 15)
- `mapHeight`: 地图高度 (默认: 8)

### 生成参数
- `minRegisters/maxRegisters`: 缓存区数量范围 (3-5)
- `minFirewalls/maxFirewalls`: 防火墙数量范围 (8-12)
- `corrosionProbability`: 腐蚀地块生成概率 (0.15)
- `bugProbability`: 虫洞地块生成概率 (0.1)

### 区域限制
- `playerDeploymentRows`: 玩家部署区行数 (默认: 2)
- `enemySpawnRows`: 敌人生成区行数 (默认: 2)

## 使用方法

### 1. 基本设置
1. 将 RandomMapGenerator 脚本添加到场景中的 GameObject
2. 设置必要的引用：
   - GridManager
   - Terrain Tilemap
   - Object Tilemap
   - 各种 ScriptableObject 数据
   - 瓦片资源

### 2. 生成地图
```csharp
// 调用生成方法
randomMapGenerator.GenerateRandomMap();
```

### 3. 测试功能
使用 MapGeneratorTester 脚本进行测试：
1. 将 MapGeneratorTester 添加到场景
2. 设置 mapGenerator 引用
3. 使用 Context Menu 进行手动测试
4. 或启用 autoTest 进行自动测试

## 约束条件

### 区域限制规则
1. **玩家部署区**:
   - 不能有防火墙或缓存区
   - 不能有虫洞地块
   - 可以有腐蚀地块

2. **敌人生成区**:
   - 不能有防火墙或缓存区
   - 不能有虫洞地块
   - 可以有腐蚀地块

3. **中间区域**:
   - 缓存区只能放置在此区域
   - 可以包含所有类型的地形和对象

### 路径连通性
- 必须存在从敌人生成区到玩家部署区的可行走路径
- 系统会自动验证和修复路径问题
- 如果无法修复，会重新生成地图

## 性能考虑
- 地图生成使用递归重试机制，通常在几次尝试内完成
- 路径验证使用 BFS 算法，时间复杂度为 O(n)
- 建议在游戏开始前预生成地图，避免运行时生成

## 调试信息
生成过程中会输出详细的调试信息：
- 地图尺寸和对象数量
- 路径验证结果
- 区域限制应用情况
- 生成完成确认

## 扩展性
系统设计支持以下扩展：
- 添加新的地形类型
- 添加新的可破坏对象类型
- 修改区域限制规则
- 调整生成算法参数